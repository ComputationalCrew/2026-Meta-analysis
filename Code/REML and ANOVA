library(jtools)
library(car)
library(tidyverse)
library(multcomp)
library(lme4)
library(dplyr)
library(ggplot2)
library(emmeans)
library(tidyr)
library(readr)
library(pivottabler)
library(stats)
library(metafor)
library(writexl)

# Create the data frame_Oregon
Meta_downy <- read.csv("…/DM_GitHub_OR.csv", check.names=FALSE)

# Create the data frame_Washington
Meta_downy <- read.csv("…/DM_GitHub_WA.csv", check.names=FALSE)

# Create the data frame_Total
Meta_downy <- read.csv("…/DM_GitHub_Total.csv", check.names=FALSE)

downy.lm1 <- lmer(tResponse_ratio ~ MOA +  (1|Trial) + (1|Rep) + (1|MOA:Trial) + (1|Trial:Rep) 
                  , REML=TRUE, data = Meta_downy)

# Table 3 and Supplemental Table 5
summ(downy.lm1)

# Table 2
anova_results <- Anova(downy.lm1, type = "III")
print(anova_results)

# Supplemental Figure 1
png("residual.png",width=12,height=8,units="cm" , res = 1000)
plot(downy.lm1)
dev.off()

png("qqnorm.png",width=12,height=8,units="cm" , res = 1000)
qqnorm(resid(downy.lm1))
dev.off()

# Supplemental Table 2
downy.state <- lmer(tResponse_ratio ~ MOA +  (1|Trial) + (1|Rep) + (1|MOA:Trial) + (1|Trial:Rep) + State + MOA*State
                  , REML=TRUE, data = Meta_downy)
summ(downy.state)

# Supplemental Table 3

downy.mean_state <- lmer(tResponse_ratio ~ MOA +  (1|Trial) + (1|Rep) + (1|MOA:Trial) + (1|Trial:Rep) + State + meanSpikes +MOA*meanSpikes
                  , REML=TRUE, data = Meta_downy)
summ(downy.mean_state)

# Supplemental Table 4
downy.mean <- lmer(tResponse_ratio ~ MOA +  (1|Trial) + (1|Rep) + (1|MOA:Trial) + (1|Trial:Rep) + meanSpikes +MOA*meanSpikes
                  , REML=TRUE, data = Meta_downy)
summ(downy.mean)
